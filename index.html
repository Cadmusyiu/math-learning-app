<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>è±è±è€å¸«æ•¸å­¸åŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #FFE4E1 0%, #FFF0F5 100%);
        }
    </style>
</head>
<body>
    <div id="root" class="container mx-auto p-6"></div>

    <script type="text/babel">
    function MathLearningApp() {
        const [problem, setProblem] = React.useState(null);
        const [feedback, setFeedback] = React.useState('');
        const [score, setScore] = React.useState(0);
        const [problemType, setProblemType] = React.useState('addition');
        const [selectedMultiplicationTable, setSelectedMultiplicationTable] = React.useState(null);
        const [droppedNumber, setDroppedNumber] = React.useState(null);

        // ç”ŸæˆåŠ æ³•å•é¡Œ - ç¢ºä¿çµæœä¸è¶…é10
        const generateAdditionProblem = () => {
            const firstNumber = Math.floor(Math.random() * 10); // 0-9
            const secondNumber = Math.floor(Math.random() * (10 - firstNumber)); // ç¢ºä¿ç¸½å’Œä¸è¶…é10
            const result = firstNumber + secondNumber;
            
            return {
                firstNumber,
                secondNumber,
                result,
                operator: '+',
                correctAnswer: secondNumber,
                hiddenNumberPosition: 'second'
            };
        };

        // ç”Ÿæˆæ¸›æ³•å•é¡Œ - å›ºå®šç‚º0-9çš„å–®ä¸€ä½æ•¸æ¸›æ³•
        const generateSubtractionProblem = () => {
            const firstNumber = Math.floor(Math.random() * 9) + 1; // 1-9
            const secondNumber = Math.floor(Math.random() * firstNumber); // 0åˆ°firstNumber-1
            const result = firstNumber - secondNumber;
            
            return {
                firstNumber,
                secondNumber,
                result,
                operator: '-',
                correctAnswer: secondNumber,
                hiddenNumberPosition: 'second'
            };
        };

        // ç”Ÿæˆä¹˜æ³•å•é¡Œ - æ ¹æ“šé¸æ“‡çš„ä¹˜æ•¸è¡¨
        const generateMultiplicationProblem = () => {
            if (!selectedMultiplicationTable) return null;
            const secondNumber = Math.floor(Math.random() * 9) + 1; // 1-9
            const result = selectedMultiplicationTable * secondNumber;
            const hideFirst = Math.random() > 0.5;
            return {
                firstNumber: selectedMultiplicationTable,
                secondNumber,
                result,
                operator: 'Ã—',
                correctAnswer: hideFirst ? selectedMultiplicationTable : secondNumber,
                hiddenNumberPosition: hideFirst ? 'first' : 'second'
            };
        };

        // ç”Ÿæˆæ–°å•é¡Œ
        const generateNewProblem = React.useCallback(() => {
            let newProblem;
            switch(problemType) {
                case 'addition':
                    newProblem = generateAdditionProblem();
                    break;
                case 'subtraction':
                    newProblem = generateSubtractionProblem();
                    break;
                case 'multiplication':
                    newProblem = generateMultiplicationProblem();
                    break;
                default:
                    newProblem = generateAdditionProblem();
            }
            setProblem(newProblem);
            setDroppedNumber(null);
            setFeedback('');
        }, [problemType, selectedMultiplicationTable]);

        // æª¢æŸ¥ç­”æ¡ˆ
        const checkAnswer = (number) => {
            if (number === problem.correctAnswer) {
                setFeedback('âœ… å¤ªæ£’äº†ï¼ç­”å°äº†ï¼');
                setScore(prevScore => prevScore + 1);
                setTimeout(generateNewProblem, 1500);
            } else {
                setFeedback('âŒ å†è©¦ä¸€æ¬¡å–”ï¼');
                setTimeout(() => setFeedback(''), 1500);
            }
        };

        // åˆå§‹åŒ–å•é¡Œ
        React.useEffect(() => {
            generateNewProblem();
        }, [problemType, selectedMultiplicationTable, generateNewProblem]);

        // æ¸²æŸ“å•é¡Œé¡¯ç¤º
        const renderEquation = () => {
            const { firstNumber, secondNumber, result, operator, hiddenNumberPosition } = problem;
            if (hiddenNumberPosition === 'first') {
                return (
                    <div className="text-5xl font-bold mb-6 text-gray-700">
                        ? {operator} {secondNumber} = {result}
                    </div>
                );
            }
            return (
                <div className="text-5xl font-bold mb-6 text-gray-700">
                    {firstNumber} {operator} ? = {result}
                </div>
            );
        };

        return (
            <div className="max-w-md mx-auto p-6 bg-white bg-opacity-80 rounded-2xl shadow-2xl text-center relative overflow-hidden">
                {/* å¯æ„›çš„è£é£¾ */}
                <div className="absolute top-0 left-0 w-full h-2 bg-pink-300"></div>
                <div className="absolute bottom-0 left-0 w-full h-2 bg-pink-300"></div>

                {/* æ¨™é¡Œ */}
                <h1 className="text-3xl font-bold mb-6 text-pink-600 drop-shadow-md">
                    è±è±è€å¸«æ•¸å­¸åŠ ğŸ§®
                </h1>
                
                {/* å•é¡Œé¡å‹é¸æ“‡ */}
                <div className="mb-6 flex justify-center space-x-3">
                    <button 
                        onClick={() => {
                            setProblemType('addition');
                            setSelectedMultiplicationTable(null);
                        }} 
                        className={`px-4 py-2 rounded-full shadow-md transition-all duration-300 
                            ${problemType === 'addition' 
                                ? 'bg-green-500 text-white scale-105' 
                                : 'bg-green-100 text-green-600 hover:bg-green-200'}`}
                    >
                        åŠ æ³•
                    </button>
                    <button 
                        onClick={() => {
                            setProblemType('subtraction');
                            setSelectedMultiplicationTable(null);
                        }} 
                        className={`px-4 py-2 rounded-full shadow-md transition-all duration-300 
                            ${problemType === 'subtraction' 
                                ? 'bg-blue-500 text-white scale-105' 
                                : 'bg-blue-100 text-blue-600 hover:bg-blue-200'}`}
                    >
                        æ¸›æ³•
                    </button>
                    <button 
                        onClick={() => setProblemType('multiplication')} 
                        className={`px-4 py-2 rounded-full shadow-md transition-all duration-300 
                            ${problemType === 'multiplication' 
                                ? 'bg-purple-500 text-white scale-105' 
                                : 'bg-purple-100 text-purple-600 hover:bg-purple-200'}`}
                    >
                        ä¹˜æ³•
                    </button>
                </div>

                {/* ä¹˜æ³•è¡¨é¸æ“‡ */}
                {problemType === 'multiplication' && !selectedMultiplicationTable && (
                    <div className="mb-6 bg-purple-50 p-6 rounded-xl shadow-inner">
                        <h2 className="text-xl font-bold mb-4 text-purple-700">é¸æ“‡è¦ç·´ç¿’çš„ä¹˜æ•¸è¡¨</h2>
                        <div className="grid grid-cols-3 gap-3">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                                <button
                                    key={num}
                                    onClick={() => setSelectedMultiplicationTable(num)}
                                    className="bg-purple-200 text-purple-700 py-2 rounded-lg hover:bg-purple-300 transition-colors"
                                >
                                    {num} çš„ä¹˜æ³•è¡¨
                                </button>
                            ))}
                        </div>
                    </div>
                )}

                {/* å•é¡Œé¡¯ç¤º */}
                {problem && (problemType !== 'multiplication' || selectedMultiplicationTable) && (
                    <div className="mb-6 bg-pink-50 p-6 rounded-xl shadow-inner">
                        {problemType === 'multiplication' && (
                            <div className="mb-4 text-xl text-purple-700 font-bold">
                                {selectedMultiplicationTable} çš„ä¹˜æ³•è¡¨
                                <button 
                                    onClick={() => setSelectedMultiplicationTable(null)}
                                    className="ml-3 bg-purple-200 px-2 py-1 rounded-md text-sm"
                                >
                                    é‡é¸
                                </button>
                            </div>
                        )}
                        
                        {/* æ–¹ç¨‹å¼ */}
                        {renderEquation()}
                        
                        {/* åé¥‹è¨Šæ¯ */}
                        {feedback && (
                            <div className={`mb-4 text-2xl font-bold 
                                ${feedback.includes('âœ…') 
                                    ? 'text-green-600 animate-bounce' 
                                    : 'text-red-600'}`}
                            >
                                {feedback}
                            </div>
                        )}

                        {/* æ•¸å­—é¸æ“‡å€ */}
                        <div className="grid grid-cols-3 gap-3 mb-4">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                                <button
                                    key={num}
                                    onClick={() => {
                                        setDroppedNumber(num);
                                        checkAnswer(num);
                                    }}
                                    className={`py-2 text-lg rounded-lg transition-all duration-300 
                                        ${droppedNumber === num 
                                            ? 'bg-pink-500 text-white scale-105' 
                                            : 'bg-pink-200 text-pink-700 hover:bg-pink-300'}`}
                                >
                                    {num}
                                </button>
                            ))}
                        </div>
                    </div>
                )}

                {/* åˆ†æ•¸é¡¯ç¤º */}
                <div className="text-xl text-pink-700 font-bold">
                    ç›®å‰åˆ†æ•¸ï¼š{score} åˆ†
                </div>
            </div>
        );
    }

    ReactDOM.render(<MathLearningApp />, document.getElementById('root'));
    </script>
</body>
</html>
